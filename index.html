<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kishankuarks | Galactic Defender</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap');

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #050505;
            color: white;
            overflow: hidden; /* Prevent scrolling during play */
            touch-action: none; /* Prevent browser zooming/swiping */
        }

        .font-sci-fi {
            font-family: 'Orbitron', sans-serif;
        }

        canvas {
            display: block;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.1);
        }

        /* Neon Glow Effects */
        .neon-text {
            text-shadow: 0 0 5px #0ff, 0 0 10px #0ff, 0 0 20px #0ff;
        }
        
        .neon-border {
            box-shadow: 0 0 5px #0ff, 0 0 10px #0ff; 
        }

        .ui-panel {
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        /* Pulse Animation */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
            50% { box-shadow: 0 0 25px rgba(0, 255, 255, 0.8), 0 0 5px white; }
            100% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
        }

        .btn-start {
            animation: pulse-glow 2s infinite;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <!-- Game Header -->
    <header class="absolute top-0 left-0 w-full p-4 z-20 flex justify-between items-center pointer-events-none">
        <div>
            <h1 class="font-sci-fi text-2xl md:text-4xl font-bold tracking-widest text-cyan-400 neon-text">KISHANKUARKS</h1>
            <p class="text-xs md:text-sm text-cyan-200 tracking-wider opacity-80">QUANTUM DEFENSE SYSTEM</p>
        </div>
        <div class="text-right">
            <div class="text-xs text-cyan-300 uppercase tracking-widest">Score</div>
            <div id="scoreDisplay" class="font-sci-fi text-2xl md:text-4xl font-bold text-white">0</div>
        </div>
    </header>

    <!-- Game Canvas -->
    <canvas id="gameCanvas" class="absolute top-0 left-0 w-full h-full z-0"></canvas>

    <!-- Start Screen Overlay -->
    <div id="startScreen" class="absolute inset-0 z-30 flex items-center justify-center bg-black/80 transition-opacity duration-500">
        <div class="ui-panel p-8 rounded-2xl text-center max-w-md w-full mx-4 border-t-4 border-cyan-500">
            <h2 class="font-sci-fi text-3xl md:text-5xl mb-2 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 font-black">READY PILOT?</h2>
            <p class="text-gray-300 mb-8 text-lg">Destabilized quarks are entering the sector. Destroy them before they breach the core.</p>
            
            <div class="grid grid-cols-2 gap-4 mb-8 text-sm text-cyan-200 text-left bg-black/40 p-4 rounded-lg">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-cyan-400 rounded-full"></span>
                    <span><strong>Move:</strong> Mouse / Touch</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                    <span><strong>Shoot:</strong> Click / Tap</span>
                </div>
            </div>

            <button id="startBtn" class="btn-start bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-4 px-10 rounded-full text-xl font-sci-fi tracking-widest transition-all transform hover:scale-105 active:scale-95 w-full">
                INITIALIZE
            </button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden absolute inset-0 z-30 flex items-center justify-center bg-red-900/20 backdrop-blur-sm">
        <div class="ui-panel p-8 rounded-2xl text-center max-w-md w-full mx-4 border-t-4 border-red-500 shadow-[0_0_50px_rgba(255,0,0,0.3)]">
            <h2 class="font-sci-fi text-4xl md:text-6xl mb-2 text-red-500 neon-text">CRITICAL FAILURE</h2>
            <p class="text-gray-300 mb-4">The core has been breached.</p>
            
            <div class="bg-black/50 p-4 rounded-lg mb-6 border border-red-500/30">
                <div class="text-xs text-red-300 uppercase tracking-widest">Final Score</div>
                <div id="finalScore" class="font-sci-fi text-4xl font-bold text-white">0</div>
                <div class="text-xs text-gray-400 mt-2">High Score: <span id="highScore">0</span></div>
            </div>

            <button id="restartBtn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-8 rounded-full text-lg font-sci-fi tracking-widest transition-all w-full">
                REBOOT SYSTEM
            </button>
        </div>
    </div>

    <!-- Health Bar (Bottom) -->
    <div class="absolute bottom-0 left-0 w-full p-6 z-20 pointer-events-none">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between text-xs text-cyan-300 mb-1 font-bold tracking-widest">
                <span>SHIELD INTEGRITY</span>
                <span id="healthText">100%</span>
            </div>
            <div class="h-3 w-full bg-gray-800 rounded-full overflow-hidden border border-gray-700">
                <div id="healthBar" class="h-full bg-gradient-to-r from-cyan-500 to-blue-600 transition-all duration-300" style="width: 100%;"></div>
            </div>
        </div>
    </div>

    <script>
        /**
         * KISHANKUARKS GAME ENGINE
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('scoreDisplay');
        const finalScoreEl = document.getElementById('finalScore');
        const highScoreEl = document.getElementById('highScore');
        const healthBarEl = document.getElementById('healthBar');
        const healthTextEl = document.getElementById('healthText');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');

        // Game State
        let gameActive = false;
        let animationId;
        let score = 0;
        let highScore = localStorage.getItem('kishankuarks_highscore') || 0;
        let frame = 0;
        let difficultyMultiplier = 1;

        // Player Stats
        const player = {
            x: 0,
            y: 0,
            radius: 20,
            color: '#0ff',
            speed: 0, // calculated from mouse distance
            health: 100,
            maxHealth: 100,
            weaponLevel: 1
        };

        // Input Handling
        const mouse = { x: 0, y: 0, down: false };
        
        // Game Objects
        let projectiles = [];
        let enemies = [];
        let particles = [];
        let stars = [];

        // Resize Handling
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // Center player initially
            if (!gameActive) {
                player.x = canvas.width / 2;
                player.y = canvas.height - 100;
                mouse.x = canvas.width / 2;
                mouse.y = canvas.height - 100;
            }
        }
        window.addEventListener('resize', resize);

        // Input Listeners
        window.addEventListener('mousemove', (e) => {
            // Smooth follow target, don't set instantly
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        window.addEventListener('mousedown', () => {
            if (gameActive) {
                shoot();
                mouse.down = true;
            }
        });
        
        window.addEventListener('mouseup', () => {
            mouse.down = false;
        });

        // Touch support
        window.addEventListener('touchmove', (e) => {
            e.preventDefault();
            mouse.x = e.touches[0].clientX;
            mouse.y = e.touches[0].clientY;
        }, { passive: false });

        window.addEventListener('touchstart', (e) => {
            // e.preventDefault();
            mouse.x = e.touches[0].clientX;
            mouse.y = e.touches[0].clientY;
            if (gameActive) {
                shoot();
                mouse.down = true;
            }
        }, { passive: false });
        
        window.addEventListener('touchend', () => mouse.down = false);


        // --- CLASSES ---

        class Projectile {
            constructor(x, y, velocity) {
                this.x = x;
                this.y = y;
                this.velocity = velocity;
                this.radius = 4;
                this.color = '#fff';
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
                // Glow
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#0ff';
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            update() {
                this.draw();
                this.x = this.x + this.velocity.x;
                this.y = this.y + this.velocity.y;
            }
        }

        class Enemy {
            constructor() {
                this.radius = Math.random() * (30 - 15) + 15;
                this.x = Math.random() * (canvas.width - this.radius * 2) + this.radius;
                this.y = -this.radius - 10; // Start above screen
                this.color = `hsl(${Math.random() * 60 + 270}, 80%, 50%)`; // Purples and Pinks
                this.velocity = {
                    x: (Math.random() - 0.5) * 1,
                    y: (Math.random() * 2 + 1) * difficultyMultiplier
                };
                this.spin = 0;
                this.spinSpeed = (Math.random() - 0.5) * 0.1;
                this.type = Math.random() > 0.8 ? 'chaser' : 'faller';
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.spin);
                
                // Draw a Hexagon or jagged shape for "Quark"
                ctx.beginPath();
                ctx.lineWidth = 3;
                ctx.strokeStyle = this.color;
                ctx.fillStyle = 'rgba(0,0,0,0.5)';
                const sides = 6;
                for (let i = 0; i < sides; i++) {
                    const angle = (i * 2 * Math.PI) / sides;
                    ctx.lineTo(Math.cos(angle) * this.radius, Math.sin(angle) * this.radius);
                }
                ctx.closePath();
                ctx.stroke();
                ctx.fill();

                // Inner Core
                ctx.beginPath();
                ctx.arc(0, 0, this.radius * 0.4, 0, Math.PI * 2);
                ctx.fillStyle = 'white';
                ctx.fill();

                ctx.restore();
            }

            update() {
                this.draw();
                
                if (this.type === 'chaser' && this.y < player.y) {
                    // Slowly move towards player x
                    if (this.x < player.x) this.velocity.x += 0.05;
                    else this.velocity.x -= 0.05;
                    // Cap horizontal speed
                    if (this.velocity.x > 2) this.velocity.x = 2;
                    if (this.velocity.x < -2) this.velocity.x = -2;
                }

                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.spin += this.spinSpeed;
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.radius = Math.random() * 3;
                this.color = color;
                this.velocity = {
                    x: (Math.random() - 0.5) * 8,
                    y: (Math.random() - 0.5) * 8
                };
                this.alpha = 1;
                this.friction = 0.95;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.draw();
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.02;
            }
        }

        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.radius = Math.random() * 1.5;
                this.alpha = Math.random();
                this.velocity = Math.random() * 3 + 0.5; // Parallax effect
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = 'white';
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.draw();
                this.y += this.velocity * (difficultyMultiplier * 0.5 + 1);
                if (this.y > canvas.height) {
                    this.y = 0;
                    this.x = Math.random() * canvas.width;
                }
            }
        }

        // --- GAME LOGIC ---

        function init() {
            resize();
            highScoreEl.innerText = highScore;
            
            // Create Stars Background
            stars = [];
            for (let i = 0; i < 100; i++) {
                stars.push(new Star());
            }
        }

        function startGame() {
            gameActive = true;
            score = 0;
            scoreEl.innerText = score;
            difficultyMultiplier = 1;
            frame = 0;
            
            // Reset Arrays
            projectiles = [];
            enemies = [];
            particles = [];
            
            // Reset Player
            player.health = 100;
            updateHealthUI();
            player.x = canvas.width / 2;
            player.y = canvas.height - 100;
            mouse.x = canvas.width / 2;
            mouse.y = canvas.height - 100;

            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            
            animate();
        }

        function spawnEnemies() {
            // Spawn rate increases with difficulty
            let spawnRate = 60;
            if (score > 1000) spawnRate = 50;
            if (score > 3000) spawnRate = 40;
            if (score > 5000) spawnRate = 30;

            if (frame % spawnRate === 0) {
                enemies.push(new Enemy());
            }
        }

        function shoot() {
            const angle = -Math.PI / 2; // Straight up
            const velocity = {
                x: 0,
                y: -15
            };
            
            // Left wing
            projectiles.push(new Projectile(player.x - 15, player.y, velocity));
            // Right wing
            projectiles.push(new Projectile(player.x + 15, player.y, velocity));

            // Sound effect logic would go here
        }

        function updateHealthUI() {
            healthBarEl.style.width = `${player.health}%`;
            healthTextEl.innerText = `${Math.ceil(player.health)}%`;
            if (player.health < 30) {
                healthBarEl.classList.remove('from-cyan-500', 'to-blue-600');
                healthBarEl.classList.add('bg-red-600');
            } else {
                healthBarEl.classList.add('from-cyan-500', 'to-blue-600');
                healthBarEl.classList.remove('bg-red-600');
            }
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            finalScoreEl.innerText = score;
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('kishankuarks_highscore', highScore);
            }
            highScoreEl.innerText = highScore;
            
            gameOverScreen.classList.remove('hidden');
        }

        function drawPlayer() {
            // Move player towards mouse with some lag (smoothing)
            // Linear interpolation (Lerp)
            const dx = mouse.x - player.x;
            const dy = mouse.y - player.y;
            
            // Move logic
            player.x += dx * 0.15;
            player.y += dy * 0.15;

            // Boundary checks
            if (player.x < player.radius) player.x = player.radius;
            if (player.x > canvas.width - player.radius) player.x = canvas.width - player.radius;
            if (player.y < player.radius) player.y = player.radius;
            if (player.y > canvas.height - player.radius) player.y = canvas.height - player.radius;

            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Bank effect based on movement
            const bankAngle = (dx * 0.05) * (Math.PI / 180);
            ctx.rotate(bankAngle);

            // Draw Ship (Triangle Design)
            ctx.beginPath();
            ctx.moveTo(0, -30); // Nose
            ctx.lineTo(20, 20); // Right Wing
            ctx.lineTo(0, 10);  // Center Engine
            ctx.lineTo(-20, 20); // Left Wing
            ctx.closePath();
            
            ctx.fillStyle = '#000';
            ctx.strokeStyle = '#0ff';
            ctx.lineWidth = 2;
            ctx.shadowColor = '#0ff';
            ctx.shadowBlur = 20;
            
            ctx.fill();
            ctx.stroke();

            // Engine Flame
            ctx.shadowBlur = 0;
            ctx.beginPath();
            ctx.moveTo(-10, 20);
            ctx.lineTo(0, 35 + Math.random() * 10);
            ctx.lineTo(10, 20);
            ctx.fillStyle = '#f0f'; // Purple flame
            ctx.fill();

            ctx.restore();
        }

        function animate() {
            if (!gameActive) return;
            
            animationId = requestAnimationFrame(animate);
            // Trail effect
            ctx.fillStyle = 'rgba(5, 5, 5, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Background
            stars.forEach(star => star.update());

            drawPlayer();
            
            // Auto-fire if mouse held down (optional feature, currently click only triggers once)
            // To make it auto-fire, uncomment below:
            // if (mouse.down && frame % 10 === 0) shoot();

            // Projectiles
            projectiles.forEach((projectile, index) => {
                projectile.update();
                
                // Remove off-screen projectiles
                if (projectile.y + projectile.radius < 0) {
                    setTimeout(() => {
                        projectiles.splice(index, 1);
                    }, 0);
                }
            });

            // Particles (Explosions)
            particles.forEach((particle, index) => {
                if (particle.alpha <= 0) {
                    particles.splice(index, 1);
                } else {
                    particle.update();
                }
            });

            // Enemies
            enemies.forEach((enemy, index) => {
                enemy.update();

                // Player Collision
                const distToPlayer = Math.hypot(player.x - enemy.x, player.y - enemy.y);
                if (distToPlayer - enemy.radius - player.radius < 1) {
                    // Collision with Player
                    // Create explosion
                    for (let i = 0; i < 15; i++) {
                        particles.push(new Particle(enemy.x, enemy.y, enemy.color));
                    }
                    enemies.splice(index, 1);
                    
                    player.health -= 25;
                    updateHealthUI();
                    
                    // Screen shake (simulate by offsetting canvas briefly - simplified here)
                    if (player.health <= 0) {
                        // Big explosion
                        for (let i = 0; i < 50; i++) {
                            particles.push(new Particle(player.x, player.y, '#0ff'));
                        }
                        gameOver();
                    }
                }

                // Projectile Collision
                projectiles.forEach((projectile, pIndex) => {
                    const dist = Math.hypot(projectile.x - enemy.x, projectile.y - enemy.y);
                    
                    if (dist - enemy.radius - projectile.radius < 1) {
                        // Hit!
                        
                        // Explosion particles
                        for (let i = 0; i < 8; i++) {
                            particles.push(new Particle(projectile.x, projectile.y, enemy.color));
                        }

                        // Remove projectile and enemy
                        setTimeout(() => {
                            projectiles.splice(pIndex, 1);
                            enemies.splice(index, 1);
                        }, 0);

                        // Score
                        score += 100;
                        scoreEl.innerText = score;
                        
                        // Increase difficulty slightly
                        if (score % 1000 === 0) {
                            difficultyMultiplier += 0.1;
                        }
                    }
                });

                // Remove off-screen enemies
                if (enemy.y - enemy.radius > canvas.height) {
                    setTimeout(() => {
                        enemies.splice(index, 1);
                    }, 0);
                    // Penalty for missing enemies? Maybe lose small health or score
                    // player.health -= 5;
                    // updateHealthUI();
                }
            });

            spawnEnemies();
            frame++;
        }

        // Initialize
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);
        
        init();

    </script>
</body>
</html>